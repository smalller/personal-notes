[toc]

## HTTP1.1的缺陷
一、队头阻塞
>当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的所有请求也一并被阻塞，会导致客户端迟迟收不到数据，同一个域名最多有6个TCP连接，后续资源要排队。

解决方案：
- 将同一页面的资源分散到不同域名下，提升连接上限
- 合并小文件减少资源数，比如使用雪碧图
- 使用cdn加载
- 减少请求数量，比如将多个文件打包成一个文件

二、无状态特性
>无状态是指协议对于连接状态没有记忆能力，每次创建一个新的连接，都会重复生成报文，Header里携带的内容过大，在一定程度上增加了传输的成本。

三、明文传输
>HTTP/1.1在传输数据时，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份，这在一定程度上无法保证数据的安全性。


## HTTP2新特性
一、二进制传输
>使用二进制的方式传输数据，将Header报文压缩成二进制，数据量大幅减少。

二、多路复用
>多路复用的技术可以只通过一个 TCP 连接就可以传输所有的请求数据。
- 同域名下所有通信都在单个连接上完成。
- 单个连接可以承载任意数量的双向数据流。
- 数据流以消息的形式发送，而消息又由一个或多个帧组成，多个帧之间可以乱序发送，因为根据帧首部的流标识可以重新组装。

三、依然采用明文传输，但是加了密的，安全性有所提升。

## HTTP2缺点
一、队头阻塞并没有彻底解决
>HTTP/2出现丢包时，整个TCP都要开始等待重传，那么就会阻塞该TCP连接中的所有请求。而对于 HTTP/1.1 来说，可以开启多个 TCP 连接，出现这种情况反到只会影响其中一个连接，剩余的 TCP 连接还可以正常传输数据。

二、多路复用导致服务器压力上升，用容易超时


## http 和 https 的区别及优缺点
- http 是超文本传输协议，信息是明文传输，HTTPS 协议要比 http 协议安全。
- https 是具有安全性的 ssl 加密传输协议，可防止数据在传输过程中被窃取、改变，确保数据的完整性。
- http 协议的默认端口为 80，https 的默认端口为 443。
http 的连接很简单，是无状态的。https 握手阶段比较费时，会使页面加载时间延长 50%。
- https 缓存不如 http 高效，会增加数据开销。

## TCP三次握手
1. 第一次握手：建立连接时，客户端发送syn包到服务器，并进入SYN_SENT状态，等待服务器确认
2. 第二次握手：服务器收到syn包并确认客户的SYN，同时也发送一个自己的SYN包，此时服务器进入SYN_RECV状态
3. 第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK，此包发送完毕，客户端和服务器进入TCP连接成功状态，完成三次握手。
>握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。

## TCP和UDP的区别
- TCP是面向链接的，而UDP是面向无连接的。
- TCP仅支持单播传输，UDP 提供了单播，多播，广播的功能。
- TCP的三次握手保证了连接的可靠性; UDP是无连接的、不可靠的一种数据传输协议，首先不可靠性体现在无连接上，通信都不需要建立连接，对接收到的数据也不发送确认信号，发送端不知道数据是否会正确接收。
- UDP的头部开销比TCP的更小，数据传输速率更高，实时性更好。

## 从输入URL到页面加载的全过程
1. 首先在浏览器中输入URL
2. 查找缓存：浏览器先查看浏览器缓存-系统缓存-路由缓存中是否有该地址页面，如果有则显示页面内容。如果没有则进行下一步
3. DNS域名解析：浏览器向DNS服务器发起请求，解析该URL中的域名对应的IP地址
4. 建立TCP连接：解析出IP地址后，根据IP地址和默认80端口，和服务器建立TCP连接
5. 发起HTTP请求：浏览器发起读取文件的HTTP请求，通过三次握手将数据发送给服务器
6. 服务器响应请求并返回结果：服务器对浏览器请求做出响应，并把对应的html文件发送给浏览器，浏览器将该结果和缓存标识存入浏览器缓存中
7. 关闭TCP连接
8. 浏览器渲染：浏览器解析HTML内容并渲染出来，流程如下：
- 构建DOM树：通过词法分析解析成DOM树，DOM树由dom元素及属性节点组成，树的根是document对象
- 构建CSS规则树：生成CSS规则树
- 构建render树：浏览器将DOM树和CSS规则树结合，并构建出渲染树
- 布局：计算出每个节点在屏幕中的位置
- 绘制：遍历render树，绘制每个节点


## 强缓存与协商缓存
一、强缓存
>强缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程。

强缓存的情况主要有三种：
- 不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求（跟第一次发起请求一致）。
- 存在该缓存结果和缓存标识，但该结果已失效，强制缓存失效，则使用协商缓存。
- 存在该缓存结果和缓存标识，且该结果尚未失效，强制缓存生效，直接返回该结果

二、协商缓存
>协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程。


强缓存与协商缓存：
1.第一次请求 a.js ，缓存表中没该信息，直接请求后端服务器，请求完后存入缓存表中。
2.第二次请求 a.js ，缓存表中是 max-age， 那么命中强缓存，然后判断是否过期，如果没过期，直接读缓存的a.js，如果过期了，则执行协商缓存

## web基础
### 媒体类型
MIME类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔
- HTML格式的文档由text/html类型来标记
- 普通的ASCII文本文档由text/plain类型来标记
- JPEG格式的图片为image/jpeg类型
- GIF格式的图片为image/gif类型
### URI
服务器资源名称被称为统一资源标识符（URI）
如：http://www.smalll.cn/img/demo.jpg
给定了URI，HTTP就可以解析出对象
URI就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源
URI有两种形式：URL和URN
### URL
统一资源定位符（URL）是资源标识符最常见的形式。URL描述了一台特定服务器上某资源的特定位置
大部分URL都遵循一种标准格式
- 第一部分被称为方案，说明了访问资源所使用的协议类型，这部分通常就是HTTP协议（http://）
- 第二部分为服务器的地址（如：www.smalll.cn）
- 第三部分为服务器上的资源路径（如：/img/demo.jpg）

现在，几乎所有的URI都是URL

### URN
统一资源名（URN）是作为特定内容的唯一名称使用的，与目前的资源所在地无关。使用URN，就可以将资源四处搬移，还可以用同一个名字通过多种网络访问协议来访问资源
URN仍然处于试验阶段，还未大范围使用

## 事务
一个HTTP事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成。这种通信是通过名为HTTP报文的格式化数据块进行的
### 方法
常见的5种HTTP方法
- GET       从服务器向客户端发送命名资源
- PUT       将来自客户端的数据存储到一个命名的服务器资源中去
- DELETE    从服务器中删除命名资源
- POST      将客户端数据发送到一个服务器网关应用程序
- HEAD      仅发送命名资源响应中的HTTP首部
### 状态码
常见的状态码
- 200   文档正确返回
- 302   重定向，到其他地方去获取资源
- 404   未找到，无法找到这个资源
## 报文
客户端发往服务器的叫请求报文，服务器发往客户端的叫响应报文
HTTP报文包括以下三个报文：
- 起始行
- 首部字符
- 主体

## 链接
### TCP/IP
HTTP是应用层协议，它无需操心网络通信的具体细节；联网的细节都交给了通用、可靠的因特网传输协议TPC/IP
TCP提供了：
- 无差错的数据传输
- 按序传输
- 未分段的数据流（可在任意时刻按任意尺寸将数据发送出去）

HTTP协议位于TCP的上层，HTTP使用TCP来传输其报文数据
HTTP网络协议栈：
HTTP：应用层
    ↓
TCP：传输层
    ↓
IP：网络层
    ↓
网络特有的链路接口：数据链路层
    ↓
物理网络硬件：物理层

基本的浏览器连接处理：
- 浏览器从URL中解析出服务器的域名
- 浏览器将服务器的域名通过DNS域名解析服务转换成服务器的IP地址
- 浏览器将端口号从URL中解析出来，没有端口号就默认为80
- 浏览器建立一条与web服务器的TCP连接
- 浏览器向服务器发送一条HTTP请求报文
- 服务器向浏览器回送一条HTTP响应报文
- 关闭连接，浏览器显示文档
## web的结构组件
- 代理：位于客户端和服务器之间的HTTP中间实体
- 缓存：HTTP的仓库，使常用页面的副本可以保存在离客户的更近的地方
- 网关：连接其他应用程序的特殊web服务器
- 隧道：对HTTP通信报文进行盲转发的特殊代理
- Agent代理：发起自动HTTP请求的半智能web客户端
### 代理
代理位于客户端和服务器之间，接收所有客户端的HTTP请求，并将这些请求转发给服务器。通常会将代理作为转发所有web流量的可信任中间节点使用，代理还可以对请求和响应进行过滤
### 网关
网关一种特殊的服务器，作为其他服务器的中间实体使用，通常用于将HTTP流量转换成其他协议
### 隧道
隧道是建立起来之后，就会在两条连接直接对原始数据进行盲转发的HTTP应用程序，转发时不会窥探数据

## URL
URL可以通过HTTP之外的其他协议来访问资源，他们可以指向任意资源
如：
- mailto协议：收发邮件
- ftp协议：访问各种文件
- rtsp协议：从流视频服务器上上下载电影

URL提供了一种统一的资源命名方式，即：“方案://服务器地址/路径”结构
针对不同的方案，URL的语法会有所不同

大多数URL的语法都建立在由9部分构成的通用格式上：
- 方案：访问服务器以获取资源时要使用的协议
- 用户：某些方案访问资源时需要的用户名
- 密码：用户名后面可能要包含的密码，中间由冒号分隔，默认值为邮箱的地址
- 主机：资源服务器的域名或IP地址
- 端口：资源服务器正在监听的端口号，HTTP的默认端口号为80
- 路径：服务器上资源的本地路径
- 参数：某些方案会指定输入参数，参数为：键/值对
- 查询：某些方案要传递参数以激活程序（如数据库等）
- 片段：使用时，不会将片段传送给服务器，这个片段是在客户端内部使用的，通过字符"#"将其与URL的其余部分分隔开来，即定位锚点

URL最重要的3部分就是方案，主机，路径，也是HTTP协议的构成

## HTTP报文
- 报文由起始行、首部和实体的主体部分三个部分组成
- 报文分为请求报文和响应报文

格式组成部分
- 方法
- 请求URL
- 版本
- 状态码
- 原因断句
- 首部
- 实体的主体部分

状态码分类
- 100~101   信息提示
- 200~206   成功
- 300~305   重定向
- 400~415   客户端错误
- 500~505   服务器错误
